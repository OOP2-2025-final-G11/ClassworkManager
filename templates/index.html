<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>時間割管理アプリ</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='base-style.css') }}"
    />
  </head>
  <body>
    <h1>時間割管理アプリ</h1>
    <div class="dashboard-container">
      <!-- 時間割 -->
      <div class="timetable-area">
        <div class="section-header">
          <h2>時間割</h2>
          <a href="/timetable/upload" class="button btn-upload-small" style="text-decoration: none;">
            画像アップロード
          </a>
        </div>
        {% include "classwork_dashboard.html" %}
      </div>


      <!-- TODOリスト -->
      <div class="todo-area">
        <h2>課題リスト</h2>
        <div class="todo-main-outer">
          <div class="todo-list">
            {% for item in todos %}
            <div class="todo-card">
              <div class="todo-content">
                <span class="todo-subject">
                  {{ item.classwork.name }}
                </span>
                <span class="todo-name {{ 'todo-done' if item.is_finished }}">
                  {{ item.name }}
                </span>
                <span class="todo-deadline {{ 'todo-done' if item.is_finished }}">
                  {{ item.deadline.strftime('%Y-%m-%d %H:%M') }}
                </span>
              </div>

              <div class="todo-actions">
                <form action="{{ url_for('todo.complete', todo_id=item.id) }}" method="POST">
                  <button type="submit" class="button {{ 'btn-undo' if item.is_finished else 'btn-complete' }}">{{ '戻す' if item.is_finished else '完了' }}</button>
                </form>
                
                <form action="{{ url_for('todo.delete', todo_id=item.id) }}" method="POST" 
                      onsubmit="return confirm('本当に削除しますか？');">
                  <button type="submit" class="button btn-delete">削除</button>
                </form>
              </div>
            </div>
            {% endfor %}
          </div>
          <div class="todo-footer">
            <form action ="{{ url_for('todo.delete_completed') }}" method="POST" 
                  onsubmit="return confirm('完了した課題をすべて削除しますか？');">
              <button type="submit" class="button btn-delete-completed">完了した課題をすべて削除</button>
            <a href="/todo/add" class="button btn-link">課題追加</a>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
